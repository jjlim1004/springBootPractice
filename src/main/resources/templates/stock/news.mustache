<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    this is newsPage! <!-- 나중에 지워야 할 것-->

    <form id="newsForm">
        <input type="text" id="keyword" name='keyword' placeholder="검색어">
        <label for="news_num">글 개수</label>
        <select id="news_num" name="news_num">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
        </select>
        <input type="submit" value="입력">
    </form>
    <div id="news">
    </div>
    <button id="moreNews" class="2" style="display:none;">더 보기</button>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>

//전체적 변수 설정
    var keyword;
    var news_num;
    var start_num = 1;
    //ajax로 전송될 data 설정
    var data = {'keyword': keyword,'news_num':news_num, 'start_num': start_num};

    //개수 선택 누르면 새로고침
    $("#news_num").on('change',function(){
        $("#news").children().remove();
         $("#moreNews").css("display","none");
    });

    // form 의 submit을 할 때 뉴스를 요청하는 ajax
    $("#newsForm").submit(function(e){
        e.preventDefault();
        $("#news").children().remove();
        //1.검색할 뉴스 키워드
        keyword = $("input[name='keyword']").val();
        //2.검색할 뉴스의 개수
        news_num = $("#news_num option:selected").val();
        // 1,2 의 값 가져왔는지 확인
        console.log(keyword);
        console.log(news_num);
        //data의 keyword 와 news_num 의 값 수정
        data['keyword'] = keyword;
        data['news_num'] = news_num;

        //ajax로 요청
        $.ajax({
            url:'http://127.0.0.1:8000/news/news',
            method:'GET',
            data: data,
            success:function(result){
                var str = '';
                Object.keys(result).forEach(function(key){
                    str += '<div class="news"><div class="content'+ key + '">' +
                    '<a href="'+ result[key]['url'] +'">'+ result[key]['title'] +
                    '</a></div><div class="text">'+ result[key]['text'] +'</div></div>';
                });
                $("#news").append(str);
                $("#moreNews").css("display","block");
            },
        });
      });

    //뉴스 더보기를 눌렀을때 추가 뉴스를 로딩하기
    $("#moreNews").on('click',function(e){
         data['start_num'] += Number($("#news_num option:selected").val());
         $.ajax({
            url:'http://127.0.0.1:8000/news/news',
            method:'GET',
            data: data,
            success:function(result){
                var str = '';
                Object.keys(result).forEach(function(key){
                    str += '<div class="news"><div class="content'+ key + '">' +
                    '<a href="'+ result[key]['url'] +'">'+ result[key]['title'] +
                    '</a></div><div class="text">'+ result[key]['text'] +'</div></div>';
                });
                $("#news").append(str);
            },
        });
    });

</script>
</html>